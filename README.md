
# 聊天室项目

## 项目简介

这是一个基于 Flask 和 WebSocket 的实时聊天应用，支持普通聊天室和端到端加密的隐私聊天室。

## 核心功能

### 用户认证
- 用户注册与登录
- 密码安全存储（加盐哈希，基于 SHA-256）
- 会话管理

### 聊天功能
- **普通聊天室**：
  - 支持多人实时通信与消息历史保存
  - 通过 create 页面输入房间名创建房间
  - 服务器会自动生成唯一的房间令牌
  - 创建者将直接进入房间
  - 其他用户需在 create 页面输入房间令牌加入
  - 用户创建或加入房间后：
    - 聊天室页面与主页会显示历史房间
    - 可一键重新进入历史房间
    - 历史聊天记录将完整保存
  - 当前暂不支持删除聊天记录，后续可能推出
***
- **隐私聊天室**：___基于 Web Crypto API 的端到端加密（AES-GCM）___
  **通过create页面的隐私房间按钮可以点击创造**和普通聊天室一样，服务器会生成一个唯一令牌，和普通聊天室一样，通过令牌可以让别的用户在create页面加入对应的房间，随后创造者和加入者都会看到一个密钥的输入框，此时需要你或者你的朋友想出一个**不小于16个字符的密钥，密码的复杂度将会提升房间信息传递的安全度，你和其他人都必须输入相同密钥才能正常通信，如果其中有人输入了错的密钥将看不到你发的信息，当然你也看不到他的信息，但这不会影响任何输入正确密钥的其他人通信**，并且这是***真正的端到端加解密，全由客户端进行，服务器只负责转发密文，并且不会产生任何关于隐私房间的日志***。

### 房间管理
- **初始状态**：
  在没有创建房间和加入任何房间的新用户首先映入眼帘的是主页（也是聊天室）在这个页面会有显眼的文字提示您创建或者加入房间，随后创建或者加入房间后将会进入对应聊天室，在底部显示你创造/加入过的任何房间，***如果想回到最初的首页可以点击logo，点击后会刷新你的状态将你带入首页，这里面会更清晰的显示你创造和加入过的所有房间，不过目前没有加入删除房间的功能后续可能推出***。

### 实时通信
- 使用 Socket.IO 实现 WebSocket 连接
- 实时人数统计与消息广播

## 技术栈

| 组件 | 技术 |
|------|------|
| 后端 | Flask, Flask-SocketIO |
| 前端 | HTML5, CSS3, JavaScript |
| 数据库 | SQLite3 |
| 加密 | Web Crypto API (AES-GCM), PBKDF2 |
| 会话 | Flask-Session |

## 项目结构

```
.
├── app.py                 # 主应用程序
├── helpers.py             # 工具函数（密码、数据库、令牌生成）
├── requirements.txt       # 依赖配置
├── templates/             # HTML 模板
│   ├── layout.html        # 基础布局
│   ├── index.html         # 聊天界面（主页）
│   ├── private.html       # 隐私聊天室
│   ├── login.html         # 登录页
│   ├── register.html      # 注册页
│   ├── create.html        # 房间创建/加入
│   ├── introduc.html      # 介绍页
|   └── error.html         # 错误页
|
└── static/                # 静态资源
    ├── logo.png           # logo
    └── style.css          # 样式文件

```

## 安装与运行

```bash
# 安装依赖
pip install -r requirements.txt

# 运行应用
python app.py
```

访问 `http://localhost:5000` 即可使用。

## 安全特性

- 用户密码加盐哈希存储
- 隐私聊天室采用 ***AES-GCM*** 256位加密
- PBKDF2 密钥派生（**600000** 次迭代）

### 隐私房间消息加密机制

隐私房间强制用户提供不少于 16 个字符的密钥。
客户端使用该密钥作为输入，通过 **PBKDF2（基于 SHA-256）**
并结合固定盐进行 **600,000 次迭代**，
派生出可用于 **AES-GCM** 算法的对称密钥。

在加密过程中：
- 明文首先被编码为字节数组
- 生成 12 字节随机初始化向量（IV）
- 在数据头部加入校验标识 `[E2EE]`
- 使用派生后的密钥与 IV 进行 AES-GCM 加密

所有加解密操作均在客户端完成，
服务器仅负责转发密文，不保存任何隐私房间相关日志或明文数据。
> 本项目为学习用途实现的聊天室系统，
> 加密设计用于理解端到端加密原理，
> 不建议直接用于生产环境。
